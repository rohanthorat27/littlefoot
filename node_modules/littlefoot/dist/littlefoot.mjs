import{getStyle as t}from"@pacote/get-style";import{pixels as e}from"@pacote/pixels";import{throttle as o}from"@pacote/throttle";function n(t,e){t.classList.add(e)}function i(t,e){t.classList.remove(e)}function s(t,e){return t.classList.contains(e)}const r="littlefoot__tooltip";function l(e){const o=Number.parseFloat(t(e,"marginLeft")),n=e.offsetWidth-o;return(e.getBoundingClientRect().left+n/2)/window.innerWidth}function c(e,o,s){const[r,c]=function(e,o){const n=Number.parseInt(t(o,"marginTop"),10),i=2*n+o.offsetHeight,s=e.getBoundingClientRect().top+e.offsetHeight/2,r=window.innerHeight-s;return r>=i||r>=s?["below",r-n-15]:["above",s-n-15]}(o,e);if(s!==r){i(e,"is-"+s),n(e,"is-"+r);const t=100*l(o)+"%",c="above"===r?"100%":"0";e.style.transformOrigin=t+" "+c}return[r,c]}const a="is-active",u="is-changing",d="is-scrollable",f=t=>document.body.contains(t);function m({id:o,button:m,content:p,host:v,popover:h,wrapper:g}){let b=0,y="above";return{id:o,activate:o=>{var i;m.setAttribute("aria-expanded","true"),n(m,u),n(m,a),m.insertAdjacentElement("afterend",h),h.style.maxWidth=document.body.clientWidth+"px",i=p,b=Math.round(e(t(i,"maxHeight"),i)),null==o||o(h,m)},dismiss:t=>{m.setAttribute("aria-expanded","false"),n(m,u),i(m,a),i(h,a),null==t||t(h,m)},isActive:()=>s(m,a),isReady:()=>!s(m,u),ready:()=>{n(h,a),i(m,u)},remove:()=>{h.remove(),i(m,u)},reposition:()=>{if(f(h)){const[t,e]=c(h,m,y);y=t,p.style.maxHeight=Math.min(b,e)+"px",h.offsetHeight<p.scrollHeight?(n(h,d),p.setAttribute("tabindex","0")):(i(h,d),p.removeAttribute("tabindex"))}},resize:()=>{f(h)&&(h.style.left=function(e,o){const n=e.offsetWidth;return-l(o)*n+Number.parseInt(t(o,"marginLeft"),10)+o.offsetWidth/2}(p,m)+"px",g.style.maxWidth=p.offsetWidth+"px",function(t,e){const o=t.querySelector("."+r);o&&(o.style.left=100*l(e)+"%")}(h,m))},destroy:()=>v.remove()}}const p="is-fully-scrolled";function v(t,e){t.addEventListener("wheel",o((t=>e=>{const o=e.currentTarget,s=-e.deltaY;s>0&&i(t,p),o&&s<=0&&s<o.clientHeight+o.scrollTop-o.scrollHeight&&n(t,p)})(e),16))}const h="littlefoot__content",g="littlefoot__wrapper",b="littlefoot--print",y=(...t)=>t.forEach((t=>n(t,b)));function w(t,e){return Array.from(t.querySelectorAll(e))}function E(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function A(t){const e=document.createElement("div");e.innerHTML=t;const o=e.firstElementChild;return o.remove(),o}function x(t){return void 0!==t}function D(t){const e=t.parentElement,o=w(e,":scope > :not(."+b+")"),n=o.filter((t=>"HR"===t.tagName));o.length===n.length&&(y(...n.concat(e)),D(e))}function H(t,e){const o=t.parentElement;t.remove(),o&&o!==e&&!o.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&H(o,e)}function S([t,e,o],n){const i=A(o.outerHTML);w(i,'[href$="#'+t+'"]').forEach((t=>H(t,i)));const s=i.innerHTML.trim();return[e,o,{id:String(n+1),number:n+1,reference:"lf-"+t,content:s.startsWith("<")?s:"<p>"+s+"</p>"}]}function T(t){return e=>t.replace(/<%=?\s*(\w+?)\s*%>/g,((t,o)=>{var n;return String(null!==(n=e[o])&&void 0!==n?n:"")}))}function O({allowDuplicates:t,anchorParentSelector:e,anchorPattern:o,buttonTemplate:n,contentTemplate:s,footnoteSelector:r,numberResetSelector:l,scope:c}){const a=function(t,e,o){return w(t,o+' a[href*="#"]').filter((t=>(t.href+t.rel).match(e)))}(document,o,c).map(function(t,e,o,n){const i=[];return s=>{const r=s.href.split("#")[1],l=r?w(t,"#"+window.CSS.escape(r)).find((t=>e||!i.includes(t))):void 0,c=null==l?void 0:l.closest(n);if(c){i.push(c);const t=s.closest(o)||s;return[t.id||s.id,t,c]}}}(document,t,e,r)).filter(x).map(S).map(l?function(t){let e=0,o=null;return([n,i,s])=>{const r=n.closest(t);return e=o===r?e+1:1,o=r,[n,i,Object.assign(Object.assign({},s),{number:e})]}}(l):t=>t).map((([t,e,o])=>(y(t,e),D(e),[t,o]))).map(function(t,e){const o=T(t),n=T(e);return([t,e])=>{const i=e.id,s=A('<span class="littlefoot">'+o(e)+"</span>"),r=s.firstElementChild;r.setAttribute("aria-expanded","false"),r.dataset.footnoteButton="",r.dataset.footnoteId=i;const l=A(n(e));l.dataset.footnotePopover="",l.dataset.footnoteId=i;const c=E(l,g),a=E(l,h);return v(a,l),t.insertAdjacentElement("beforebegin",s),{id:i,button:r,host:s,popover:l,content:a,wrapper:c}}}(n,s)).map(m);return{footnotes:a,unmount(){a.forEach((t=>t.destroy())),w(document,"."+b).forEach((t=>i(t,b)))}}}const L="[data-footnote-id]",_=(t,e)=>t.target.closest(e),C=t=>null==t?void 0:t.dataset.footnoteId,M=t=>e=>{e.preventDefault();const o=_(e,L),n=C(o);n&&t(n)},R=document.addEventListener,W=window.addEventListener,k=(t,e,o,n)=>R(t,(t=>{const n=t.target;(null==n?void 0:n.closest(e))&&o.call(n,t)}),n);const j={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:`<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="${g}"><div class="${h}"><% content %></div></div><div class="${r}"></div></aside>`,buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function z(t={}){const e=Object.assign(Object.assign({},j),t),n=function({footnotes:t,unmount:e},o){let n;const i=t=>e=>{e.isReady()&&(e.dismiss(o.dismissCallback),setTimeout(e.remove,t))},s=e=>n=>{o.allowMultiple||t.filter((t=>t.id!==n.id)).forEach(i(o.dismissDelay)),n.isReady()&&(n.activate(o.activateCallback),n.reposition(),n.resize(),setTimeout(n.ready,e))},r=e=>o=>{const n=t.find((t=>t.id===o));n&&e(n)},l=()=>t.forEach(i(o.dismissDelay));return{activate:(t,e)=>r(s(e))(t),dismiss:(t,e)=>r(i(e))(t),dismissAll:l,touchOutside:()=>{o.dismissOnDocumentTouch&&l()},repositionAll:()=>t.forEach((t=>t.reposition())),resizeAll:()=>t.forEach((t=>t.resize())),toggle:r((t=>t.isActive()?i(o.dismissDelay)(t):s(o.activateDelay)(t))),hover:r((t=>{n=t.id,o.activateOnHover&&!t.isActive()&&s(o.hoverDelay)(t)})),unhover:r((e=>{e.id===n&&(n=null),o.dismissOnUnhover&&setTimeout((()=>t.filter((t=>t.id!==n)).forEach(i(o.dismissDelay))),o.hoverDelay)})),unmount:e}}(O(e),e),i=function(t){const e=e=>{const o=_(e,"[data-footnote-button]"),n=C(o);n?(e.preventDefault(),t.toggle(n)):_(e,"[data-footnote-popover]")||t.touchOutside()},n=o(t.repositionAll,16),i=o(t.resizeAll,16),s=M(t.hover),r=M(t.unhover),l=new AbortController,c={signal:l.signal};return R("touchend",e,c),R("click",e,c),R("keyup",(e=>{27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),c),R("gestureend",n,c),W("scroll",n,c),W("resize",i,c),k("mouseover",L,s,c),k("mouseout",L,r,c),()=>{l.abort()}}(n);return{activate(t,o=e.activateDelay){n.activate(t,o)},dismiss(t,o=e.dismissDelay){void 0===t?n.dismissAll():n.dismiss(t,o)},unmount(){i(),n.unmount()},getSetting:t=>e[t],updateSetting(t,o){e[t]=o}}}export{z as default,z as littlefoot};
